{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-bold mb-6">Market Overview</h1>

<div class="grid grid-cols-3 gap-4 mb-8" id="indices-container">
    <div class="text-slate-500">Loading...</div>
</div>

<div class="grid grid-cols-2 gap-6">
    <div class="bg-slate-900/50 p-6 rounded-xl border border-slate-800">
        <h2 class="text-lg font-semibold mb-4 text-green-400">Top Gainers</h2>
        <table class="w-full text-sm text-left" id="gainers-table">
            <thead><tr class="text-slate-500"><th>Symbol</th><th>Price</th><th>%</th></tr></thead>
            <tbody class="divide-y divide-slate-800"></tbody>
        </table>
    </div>
    <div class="bg-slate-900/50 p-6 rounded-xl border border-slate-800">
        <h2 class="text-lg font-semibold mb-4 text-red-400">Top Losers</h2>
        <table class="w-full text-sm text-left" id="losers-table">
            <thead><tr class="text-slate-500"><th>Symbol</th><th>Price</th><th>%</th></tr></thead>
            <tbody class="divide-y divide-slate-800"></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('/api/market-data/')
    .then(r => r.json())
    .then(data => {
        // Render Indices
        document.getElementById('indices-container').innerHTML = data.indices.map(i => `
            <div class="bg-slate-900 p-4 rounded-lg border border-slate-800">
                <div class="text-xs text-slate-400">${i.name}</div>
                <div class="text-xl font-bold">${i.price}</div>
                <div class="${i.change > 0 ? 'text-green-500':'text-red-500'}">${i.change}%</div>
            </div>
        `).join('');
        
        // Render Gainers
        document.getElementById('gainers-table').querySelector('tbody').innerHTML = data.gainers.map(s => `
            <tr class="h-10"><td>${s.symbol}</td><td>${s.ltp}</td><td class="text-green-500">+${s.change}%</td></tr>
        `).join('');

        // Render Losers
        document.getElementById('losers-table').querySelector('tbody').innerHTML = data.losers.map(s => `
            <tr class="h-10"><td>${s.symbol}</td><td>${s.ltp}</td><td class="text-red-500">${s.change}%</td></tr>
        `).join('');
    });
</script>
{% endblock %}